generator client {
  provider = "prisma-client-js"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Carrera {
  id_carrera        Int           @id @default(autoincrement())
  nombre            String        @unique @db.VarChar(100)
  descripcion       String?       @db.Text
  duracion_semestres Int?
  estado            EstadoGeneral @default(activo)
  
  // Relaciones
  especialidades    Especialidad[]
  estudiantes       Estudiante[]
  
  @@map("carrera")
}

model Especialidad {
  id_especialidad Int          @id @default(autoincrement())
  nombre          String       @db.VarChar(100)
  id_carrera      Int
  
  // Relaciones
  carrera         Carrera      @relation(fields: [id_carrera], references: [id_carrera], onDelete: Cascade)
  materias        Materia[]
  
  @@map("especialidad")
}

model Ciclo {
  id_ciclo     Int         @id @default(autoincrement())
  nombre       String      @db.VarChar(50)
  fecha_inicio DateTime
  fecha_fin    DateTime
  estado       EstadoGeneral @default(activo)
  
  // Relaciones
  materias     Materia[]
  
  @@map("ciclo")
}

model Materia {
  id_materia      Int       @id @default(autoincrement())
  nombre          String    @db.VarChar(150)
  codigo          String    @unique @db.VarChar(20)
  creditos        Int
  horas_semanales Int?
  id_especialidad Int
  id_ciclo        Int
  
  // Relaciones
  especialidad    Especialidad @relation(fields: [id_especialidad], references: [id_especialidad], onDelete: Cascade)
  ciclo           Ciclo        @relation(fields: [id_ciclo], references: [id_ciclo], onDelete: Cascade)
  asignacionesDocentes AsignacionDocenteMateria[]
  matriculas      Matricula[]
  
  @@map("materia")
}

model Docente {
  id_docente      Int       @id @default(autoincrement())
  codigo_docente  String    @unique @db.VarChar(20)
  nombres         String    @db.VarChar(100)
  apellidos       String    @db.VarChar(100)
  email           String?   @unique @db.VarChar(150)
  telefono        String?   @db.VarChar(15)
  especialidad    String?   @db.VarChar(100)
  estado          EstadoGeneral @default(activo)
  
  // Relaciones
  asignacionesMaterias AsignacionDocenteMateria[]
  
  @@map("docente")
}

model Estudiante {
  id_estudiante   Int           @id @default(autoincrement())
  codigo_estudiante String      @unique @db.VarChar(20)
  nombres         String        @db.VarChar(100)
  apellidos       String        @db.VarChar(100)
  email           String?       @unique @db.VarChar(150)
  telefono        String?       @db.VarChar(15)
  fecha_ingreso   DateTime?
  id_carrera      Int
  estado          EstadoEstudiante @default(activo)
  
  // Relaciones
  carrera         Carrera       @relation(fields: [id_carrera], references: [id_carrera], onDelete: Cascade)
  matriculas      Matricula[]
  
  @@map("estudiante")
}

// Tabla intermedia N:M Docente - Materia
model AsignacionDocenteMateria {
  id_asignacion    Int      @id @default(autoincrement())
  id_docente       Int
  id_materia       Int
  grupo            String?  @db.VarChar(10)
  horario          String?  @db.Text  // JSON como texto
  fecha_asignacion DateTime @default(now())
  
  // Relaciones
  docente          Docente  @relation(fields: [id_docente], references: [id_docente], onDelete: Cascade)
  materia          Materia  @relation(fields: [id_materia], references: [id_materia], onDelete: Cascade)
  
  @@unique([id_docente, id_materia, grupo], name: "unique_docente_materia_grupo")
  @@map("asignacion_docente_materia")
}

// Tabla intermedia N:M Estudiante - Materia
model Matricula {
  id_matricula    Int             @id @default(autoincrement())
  id_estudiante   Int
  id_materia      Int
  fecha_matricula DateTime        @default(now())
  calificacion    Float?          // 0.0 a 20.0
  estado          EstadoMatricula @default(cursando)
  
  // Relaciones
  estudiante      Estudiante      @relation(fields: [id_estudiante], references: [id_estudiante], onDelete: Cascade)
  materia         Materia         @relation(fields: [id_materia], references: [id_materia], onDelete: Cascade)
  
  @@unique([id_estudiante, id_materia], name: "unique_estudiante_materia")
  @@map("matricula")
}

// Enums
enum EstadoGeneral {
  activo
  inactivo
}

enum EstadoEstudiante {
  activo
  inactivo
  graduado
  retirado
}

enum EstadoMatricula {
  cursando
  aprobado
  reprobado
  retirado
}